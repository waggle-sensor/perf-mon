---
- name: Setup Grafana Dashboard 
  hosts: test_node
  become: true
  gather_facts: no

  tasks:
  - name: Create ConfigMap for Grafana dashboard
    k8s:
      kubeconfig: /etc/rancher/k3s/k3s.yaml
      state: present
      namespace: "{{ k3s_namespace }}"
      definition: "{{ lookup('template', 'kubernetes/grafana-config-datasources.yaml.j2') | from_yaml_all }}"

  - name: Deploy Grafana dashboard
    k8s:
      kubeconfig: /etc/rancher/k3s/k3s.yaml
      state: present
      namespace: "{{ k3s_namespace }}"
      definition: "{{ lookup('file', 'kubernetes/grafana.yaml') | from_yaml_all }}"